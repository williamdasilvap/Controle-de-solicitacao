<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Controle de Horas e Solicita√ß√µes</title>

  <!-- Bootstrap CSS -->
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
    rel="stylesheet"
  />

  <!-- Manifest PWA -->
  <link rel="manifest" href="manifest.webmanifest" />
  <meta name="theme-color" content="#0d6efd" />

  <link rel="stylesheet" href="styles.css" />
</head>
<body class="bg-body-tertiary">
  <div class="app-shell d-flex">
    <!-- Sidebar -->
    <aside class="app-sidebar d-flex flex-column p-3 border-end">
      <div class="d-flex align-items-center mb-4">
        <div class="sidebar-logo me-2 d-flex align-items-center justify-content-center rounded-3 bg-primary text-white">
          ‚è±Ô∏è
        </div>
        <div>
          <div class="fw-semibold small">Controle de Horas</div>
          <div class="text-muted tiny">Solicita√ß√µes & Tempo</div>
        </div>
      </div>

      <nav class="nav nav-pills flex-column mb-4" id="mainTabs" role="tablist">
        <button class="nav-link active d-flex align-items-center gap-2" id="solicitacoes-tab"
                data-bs-toggle="tab" data-bs-target="#solicitacoes" type="button" role="tab">
          <span>üìÑ</span><span class="small">Solicita√ß√µes</span>
        </button>
        <button class="nav-link d-flex align-items-center gap-2" id="trabalho-tab"
                data-bs-toggle="tab" data-bs-target="#trabalho" type="button" role="tab">
          <span>‚ñ∂Ô∏è</span><span class="small">Trabalho</span>
        </button>
        <button class="nav-link d-flex align-items-center gap-2" id="relatorios-tab"
                data-bs-toggle="tab" data-bs-target="#relatorios" type="button" role="tab">
          <span>üìä</span><span class="small">Relat√≥rios</span>
        </button>
        <button class="nav-link d-flex align-items-center gap-2" id="backup-tab"
                data-bs-toggle="tab" data-bs-target="#backup" type="button" role="tab">
          <span>üíæ</span><span class="small">Backup</span>
        </button>
      </nav>

      <div class="mt-auto small text-muted">
        <div id="resumoDataAtual"></div>
        <div class="tiny">PWA offline ‚Ä¢ LocalStorage</div>
      </div>
    </aside>

    <!-- Main content -->
    <main class="app-main flex-grow-1">
      <header class="app-header border-bottom bg-white">
        <div class="container-fluid py-2">
          <div class="d-flex flex-wrap align-items-center justify-content-between gap-3">
            <div>
              <h6 class="mb-1 fw-semibold">Painel de trabalho</h6>
              <p class="mb-0 text-muted tiny">
                Cadastre solicita√ß√µes, registre o tempo e acompanhe seus relat√≥rios.
              </p>
            </div>
            <div class="d-flex flex-wrap gap-2">
              <div class="resumo-pill">
                <span class="tiny text-muted d-block">Solicita√ß√µes</span>
                <span class="fw-semibold" id="resumoTotalSolicitacoes">0</span>
              </div>
              <div class="resumo-pill">
                <span class="tiny text-muted d-block">Registros</span>
                <span class="fw-semibold" id="resumoTotalRegistros">0</span>
              </div>
              <div class="resumo-pill">
                <span class="tiny text-muted d-block">Hoje (HH:MM)</span>
                <span class="fw-semibold" id="resumoTotalHorasHoje">00:00</span>
              </div>
            </div>
          </div>
        </div>
      </header>

      <section class="app-content">
        <div class="container-fluid py-3">
          <div class="tab-content">

            <!-- ===================== SOLICITA√á√ïES ===================== -->
            <div class="tab-pane fade show active" id="solicitacoes" role="tabpanel">
              <div class="row g-3">
                <div class="col-12 col-xl-4">
                  <div class="card border-0 shadow-sm rounded-4 h-100">
                    <div class="card-header bg-white border-0 rounded-top-4">
                      <div class="d-flex align-items-center justify-content-between">
                        <h6 class="mb-0 small fw-semibold">Nova solicita√ß√£o</h6>
                        <span class="tiny text-muted">cadastro r√°pido</span>
                      </div>
                    </div>
                    <div class="card-body">
                      <form id="formSolicitacao" class="row g-3">
                        <div class="col-12">
                          <label for="numeroSolicitacao" class="form-label tiny text-uppercase text-muted">N√∫mero</label>
                          <input type="text" class="form-control form-control-sm" id="numeroSolicitacao" required />
                        </div>
                        <div class="col-12">
                          <label for="descricaoSolicitacao" class="form-label tiny text-uppercase text-muted">Descri√ß√£o</label>
                          <input type="text" class="form-control form-control-sm" id="descricaoSolicitacao" required />
                        </div>
                        <div class="col-12 d-grid">
                          <button type="submit" class="btn btn-primary btn-sm rounded-3">
                            Salvar solicita√ß√£o
                          </button>
                        </div>
                        <div class="col-12">
                          <p class="tiny text-muted mb-0">
                            Voc√™ pode repetir o mesmo n√∫mero em mais de uma solicita√ß√£o se desejar.
                          </p>
                        </div>
                      </form>
                    </div>
                  </div>
                </div>

                <div class="col-12 col-xl-8">
                  <div class="card border-0 shadow-sm rounded-4 h-100">
                    <div class="card-header bg-white border-0 rounded-top-4 d-flex align-items-center">
                      <h6 class="mb-0 small fw-semibold">Solicita√ß√µes cadastradas</h6>
                      <span class="badge bg-light text-muted ms-2 tiny" id="badgeTotalSolicitacoes">0</span>
                    </div>
                    <div class="card-body p-0">
                      <div class="table-responsive">
                        <table class="table table-sm table-hover align-middle mb-0">
                          <thead class="table-light tiny text-uppercase">
                            <tr>
                              <th>#</th>
                              <th>N√∫mero</th>
                              <th>Descri√ß√£o</th>
                              <th>Criada em</th>
                              <th class="text-end">A√ß√µes</th>
                            </tr>
                          </thead>
                          <tbody id="listaSolicitacoes" class="small"></tbody>
                        </table>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- ===================== TRABALHO / HORAS ===================== -->
            <div class="tab-pane fade" id="trabalho" role="tabpanel">
              <div class="row g-3">
                <div class="col-12 col-lg-4">
                  <div class="card border-0 shadow-sm rounded-4 h-100">
                    <div class="card-header bg-white border-0 rounded-top-4">
                      <h6 class="mb-0 small fw-semibold">Lan√ßar horas</h6>
                    </div>
                    <div class="card-body">
                      <div class="mb-3">
                        <label for="selectSolicitacaoTrabalho" class="form-label tiny text-uppercase text-muted">
                          Solicita√ß√£o
                        </label>
                        <select id="selectSolicitacaoTrabalho" class="form-select form-select-sm"></select>
                      </div>
                      <div class="d-grid gap-2">
                        <button id="btnIniciar" class="btn btn-success btn-sm rounded-3">
                          ‚ñ∂Ô∏è Iniciar
                        </button>
                        <button id="btnFinalizar" class="btn btn-danger btn-sm rounded-3">
                          ‚èπÔ∏è Finalizar
                        </button>
                      </div>
                      <p class="tiny text-muted mt-3 mb-0">
                        Ao finalizar, voc√™ poder√° ajustar manualmente os hor√°rios antes de salvar. O sistema bloqueia
                        hor√°rios que se sobrep√µem a outros registros.
                      </p>
                    </div>
                  </div>
                </div>

                <div class="col-12 col-lg-8">
                  <div class="row g-3">
                    <div class="col-12">
                      <div class="card border-0 shadow-sm rounded-4">
                        <div class="card-header bg-white border-0 rounded-top-4">
                          <h6 class="mb-0 small fw-semibold">Trabalho em andamento</h6>
                        </div>
                        <div class="card-body" id="infoTrabalhoAtual">
                          <span class="text-muted tiny">Nenhum trabalho em andamento.</span>
                        </div>
                      </div>
                    </div>

                    <div class="col-12">
                      <div class="card border-0 shadow-sm rounded-4">
                        <div class="card-header bg-white border-0 rounded-top-4 d-flex align-items-center">
                          <h6 class="mb-0 small fw-semibold">√öltimos registros</h6>
                        </div>
                        <div class="card-body p-0">
                          <div class="table-responsive">
                            <table class="table table-sm table-hover align-middle mb-0">
                              <thead class="table-light tiny text-uppercase">
                                <tr>
                                  <th>Solicita√ß√£o</th>
                                  <th>In√≠cio</th>
                                  <th>Fim</th>
                                  <th>Dura√ß√£o</th>
                                  <th class="text-end">A√ß√µes</th>
                                </tr>
                              </thead>
                              <tbody id="listaRegistrosRecentes" class="small"></tbody>
                            </table>
                          </div>
                        </div>
                      </div>
                    </div>

                  </div>
                </div>
              </div>
            </div>

            <!-- ===================== RELAT√ìRIOS ===================== -->
            <div class="tab-pane fade" id="relatorios" role="tabpanel">
              <div class="row g-3">
                <div class="col-12">
                  <div class="card border-0 shadow-sm rounded-4">
                    <div class="card-header bg-white border-0 rounded-top-4">
                      <h6 class="mb-0 small fw-semibold">Filtros</h6>
                    </div>
                    <div class="card-body row g-3 align-items-end">
                      <div class="col-6 col-md-3">
                        <label for="dataInicioRel" class="form-label tiny text-uppercase text-muted">Data in√≠cio</label>
                        <input type="date" id="dataInicioRel" class="form-control form-control-sm" />
                      </div>
                      <div class="col-6 col-md-3">
                        <label for="dataFimRel" class="form-label tiny text-uppercase text-muted">Data fim</label>
                        <input type="date" id="dataFimRel" class="form-control form-control-sm" />
                      </div>
                      <div class="col-12 col-md-4">
                        <label class="form-label tiny text-uppercase text-muted d-block">Tipo de relat√≥rio</label>
                        <div class="form-check form-check-inline tiny">
                          <input class="form-check-input" type="radio" name="tipoRel" id="relPorDia" value="dia" checked />
                          <label class="form-check-label" for="relPorDia">Por dia</label>
                        </div>
                        <div class="form-check form-check-inline tiny">
                          <input class="form-check-input" type="radio" name="tipoRel" id="relPorSolicitacao" value="solicitacao" />
                          <label class="form-check-label" for="relPorSolicitacao">Por solicita√ß√£o</label>
                        </div>
                      </div>
                      <div class="col-12 col-md-2 d-grid">
                        <button id="btnGerarRelatorio" class="btn btn-primary btn-sm rounded-3">
                          Gerar relat√≥rio
                        </button>
                      </div>
                    </div>
                  </div>
                </div>

                <div class="col-12 col-lg-6">
                  <div class="card border-0 shadow-sm rounded-4 h-100">
                    <div class="card-header bg-white border-0 rounded-top-4">
                      <h6 class="mb-0 small fw-semibold">Gr√°fico</h6>
                    </div>
                    <div class="card-body">
                      <canvas id="graficoRelatorio" height="160"></canvas>
                      <p class="tiny text-muted mt-2 mb-0">
                        O gr√°fico usa horas em formato decimal. A tabela ao lado mostra o total em HH:MM.
                      </p>
                    </div>
                  </div>
                </div>

                <div class="col-12 col-lg-6">
                  <div class="card border-0 shadow-sm rounded-4 h-100">
                    <div class="card-header bg-white border-0 rounded-top-4">
                      <h6 class="mb-0 small fw-semibold">Detalhes</h6>
                    </div>
                    <div class="card-body p-0">
                      <div class="table-responsive">
                        <table class="table table-sm table-hover align-middle mb-0">
                          <thead class="table-light tiny text-uppercase">
                            <tr>
                              <th id="colunaChaveRel">Dia</th>
                              <th>Total (HH:MM)</th>
                            </tr>
                          </thead>
                          <tbody id="tabelaRelatorio" class="small"></tbody>
                        </table>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- ===================== BACKUP ===================== -->
            <div class="tab-pane fade" id="backup" role="tabpanel">
              <div class="row g-3">
                <div class="col-12 col-lg-6">
                  <div class="card border-0 shadow-sm rounded-4 h-100">
                    <div class="card-header bg-white border-0 rounded-top-4">
                      <h6 class="mb-0 small fw-semibold">Exportar backup</h6>
                    </div>
                    <div class="card-body">
                      <p class="small mb-3">
                        Gere um arquivo JSON com todas as solicita√ß√µes e registros de horas atuais.
                      </p>
                      <button id="btnExportarBackup" class="btn btn-outline-primary btn-sm rounded-3">
                        Baixar backup (.json)
                      </button>
                    </div>
                  </div>
                </div>

                <div class="col-12 col-lg-6">
                  <div class="card border-0 shadow-sm rounded-4 h-100">
                    <div class="card-header bg-white border-0 rounded-top-4">
                      <h6 class="mb-0 small fw-semibold">Importar backup</h6>
                    </div>
                    <div class="card-body">
                      <p class="small mb-3">
                        Selecione um arquivo JSON gerado pelo sistema para restaurar os dados.
                      </p>
                      <input type="file" id="inputImportarBackup" accept="application/json"
                             class="form-control form-control-sm mb-3" />
                      <button id="btnImportarBackup" class="btn btn-outline-success btn-sm rounded-3">
                        Importar backup
                      </button>
                      <p class="mt-2 text-muted tiny mb-0">
                        Aten√ß√£o: ao importar, os dados atuais ser√£o substitu√≠dos.
                      </p>
                    </div>
                  </div>
                </div>
              </div>
            </div>

          </div>
        </div>
      </section>
    </main>
  </div>

  <!-- Modal Solicita√ß√£o (editar) -->
  <div class="modal fade" id="modalSolicitacao" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content rounded-4">
        <div class="modal-header">
          <h5 class="modal-title">Editar solicita√ß√£o</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
        </div>
        <div class="modal-body">
          <form id="formEditarSolicitacao" class="row g-3">
            <input type="hidden" id="editSolicitacaoId" />
            <div class="col-12">
              <label for="editNumeroSolicitacao" class="form-label tiny text-uppercase text-muted">N√∫mero</label>
              <input type="text" id="editNumeroSolicitacao" class="form-control form-control-sm" required />
            </div>
            <div class="col-12">
              <label for="editDescricaoSolicitacao" class="form-label tiny text-uppercase text-muted">Descri√ß√£o</label>
              <input type="text" id="editDescricaoSolicitacao" class="form-control form-control-sm" required />
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary btn-sm" data-bs-dismiss="modal">Cancelar</button>
          <button type="button" id="btnSalvarSolicitacaoEdit" class="btn btn-primary btn-sm">Salvar</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal Registro (finalizar / editar) -->
  <div class="modal fade" id="modalRegistro" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content rounded-4">
        <div class="modal-header">
          <h5 class="modal-title" id="tituloModalRegistro">Ajustar hor√°rios</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
        </div>
        <div class="modal-body">
          <form id="formRegistro">
            <input type="hidden" id="registroEditId" />
            <div class="mb-3">
              <label for="inicioEdit" class="form-label tiny text-uppercase text-muted">In√≠cio</label>
              <input type="datetime-local" id="inicioEdit" class="form-control form-control-sm" required />
            </div>
            <div class="mb-3">
              <label for="fimEdit" class="form-label tiny text-uppercase text-muted">Fim</label>
              <input type="datetime-local" id="fimEdit" class="form-control form-control-sm" required />
            </div>
          </form>
          <div class="alert alert-warning tiny mb-0">
            O hor√°rio de fim deve ser maior que o de in√≠cio e n√£o pode conflitar com outros registros.
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary btn-sm" data-bs-dismiss="modal">Cancelar</button>
          <button type="button" id="btnSalvarRegistro" class="btn btn-primary btn-sm">Salvar</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <script src="app.js"></script>

  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', function () {
        navigator.serviceWorker.register('service-worker.js').catch(function (err) {
          console.log('ServiceWorker registration failed: ', err);
        });
      });
    }

    // data atual no rodap√© do sidebar
    (function () {
      const el = document.getElementById('resumoDataAtual');
      if (!el) return;
      const hoje = new Date();
      el.textContent = hoje.toLocaleDateString('pt-BR', { weekday: 'short', day: '2-digit', month: '2-digit', year: 'numeric' });
    })();
  </script>
</body>
</html>
